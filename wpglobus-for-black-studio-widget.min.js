!function(e){"use strict";if("undefined"!=typeof WPGlobusBSWidget){var t={option:{language:WPGlobusCoreData.default_language,content:"",activeClass:"mce-active",button_separator:WPGlobusBSWidget.data.button_separator,text_separator:WPGlobusBSWidget.data.text_separator,icon:WPGlobusBSWidget.data.icon,button:WPGlobusBSWidget.data.button,button_class:WPGlobusBSWidget.data.button_class,button_classes:WPGlobusBSWidget.data.button_classes,pagenow:WPGlobusBSWidget.data.pagenow},language:{},content:{},ajaxActionId:void 0,editor:{},editorKeep:!1,preventChangeEditor:!1,saveCustomizeEditors:!1,init:function(o){t.option=e.extend(t.option,o),"customize.php"==t.option.pagenow?t.onCustomize():"widgets.php"==t.option.pagenow&&(t.addButtons(),t.addListeners(),"tinymce"!=getUserSetting("editor")&&setUserSetting("editor","tinymce"))},onCustomizeElementListeners:function(o){tinymce.get(o.id).on("change",function(o){if(!t.preventChangeEditor){var n=e(o.target.iframeElement).data("widget"),i=WPGlobusCore.TextFilter(o.level.content,WPGlobusCoreData.language);WPGlobusCustomize.controlWidgets[n].element[o.target.id].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[n].element[o.target.id].value,i,WPGlobusCoreData.language)}}),e("#"+o.id).on("change",function(o){if(!t.preventChangeEditor){var n=e(this),i=(n.data("widget"),n.attr("id"));if(tinymce.get(i).isHidden()){WPGlobusCore.TextFilter(n.html(),WPGlobusCoreData.language)}}});var n="#"+WPGlobusCustomize.controlWidgets[o.widget].submit[0].id;e(n).attr("data-editor-id",o.id),e(document).off("mouseenter",n,WPGlobusCustomize.onSubmitEvents).off("mouseleave",n,WPGlobusCustomize.onSubmitEvents).off("click",n,WPGlobusCustomize.onSubmitEvents),e(document).on("mouseenter",n,function(o){t.preventChangeEditor=!0;var n=e(this),i=n.data("editor-id");tinymce.get(i).isHidden()?e("#"+i).val(WPGlobusCustomize.controlWidgets[n.data("widget")].element[i].value):tinymce.get(i).setContent(WPGlobusCustomize.controlWidgets[n.data("widget")].element[i].value),e.each(WPGlobusCustomize.controlWidgets[n.data("widget")].element,function(t,o){t==n.data("editor-id")||e("#"+t).val(o.value)})}).on("mouseleave",n,function(o){if(t.preventChangeEditor=!1,!1===t.editorKeep){var n=e(this),i=n.data("editor-id");tinymce.get(i).isHidden()?e("#"+i).val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[n.data("widget")].element[i].value,WPGlobusCoreData.language,"RETURN_EMPTY")):tinymce.get(i).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[n.data("widget")].element[i].value,WPGlobusCoreData.language,"RETURN_EMPTY")),e.each(WPGlobusCustomize.controlWidgets[n.data("widget")].element,function(t,o){e("#"+t).val(WPGlobusCore.TextFilter(o.value,WPGlobusCoreData.language,"RETURN_EMPTY"))})}}).on("click",n,function(e){t.editorKeep={},t.editorKeep.id=o.id,t.editorKeep.widget=o.widget,t.editorKeep.language=WPGlobusCoreData.language})},onCustomize:function(){e(document).on("wpglobus_customize_control_added_widget",function(o,n){n.indexOf("black-studio")>=0&&setTimeout(function(){e.each(WPGlobusCustomize.controlWidgets[n].element,function(o,i){null!==tinymce.get(o)&&("undefined"==typeof t.editor[o]&&(t.editor[o]={}),t.editor[o].id=o,t.editor[o].widget=n,t.editor[o].iframe="#"+o+"_ifr",e(t.editor[o].iframe).addClass("wpglobus-customize-translatable-element").css({width:"99%"}).attr("data-widget",n),t.onCustomizeElementListeners(t.editor[o]))})},1e3)}),e(document).on("ajaxComplete",function(o,n){if("undefined"!=typeof n.responseText&&(t.saveCustomizeEditors&&(e.each(WPGlobusBSWidget.editor,function(e,t){tinymce.get(e).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[t.widget].element[e].value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),t.saveCustomizeEditors=!1),n.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")>=0&&t.editorKeep)){if(e(".bstw-loading").css("display","none"),tinymce.get(t.editorKeep.id).isHidden()){WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[t.editorKeep.widget].element[t.editorKeep.id].value,WPGlobusCoreData.language,"RETURN_EMPTY");e("#"+t.editorKeep.id).val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[t.editorKeep.widget].element[t.editorKeep.id].value,WPGlobusCoreData.language,"RETURN_EMPTY"))}else tinymce.get(t.editorKeep.id).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[t.editorKeep.widget].element[t.editorKeep.id].value,t.editorKeep.language,"RETURN_EMPTY"));setTimeout(function(){t.editorKeep=!1},2e3),t.preventChangeEditor=!1}}),e(document).on("wpglobus_customize_control_language",function(t,o){e.each(WPGlobusBSWidget.editor,function(e,t){tinymce.get(e).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[t.widget].element[e].value,o,"RETURN_EMPTY"))})}),e("#save").on("mouseenter",function(t){e.each(WPGlobusBSWidget.editor,function(e,t){tinymce.get(e).setContent(WPGlobusCustomize.controlWidgets[t.widget].element[e].value)})}).on("mouseleave",function(o){t.saveCustomizeEditors||e.each(WPGlobusBSWidget.editor,function(e,t){tinymce.get(e).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[t.widget].element[e].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})}).on("click",function(e){t.saveCustomizeEditors=!0})},saveContent:function(o,n){var i,a;"object"==typeof o?(i=o.getContent(),a=o.id):(a=o,i=e("#"+a).val()),t.content[a]=WPGlobusCore.getString(t.content[a],i,n)},getTranslation:function(e,o){return WPGlobusCore.getTranslations(t.content[e.id])[o]},removeClass:function(o){e(".mce-"+t.option.button_class+o).removeClass(t.option.activeClass)},fixDialogStartIcon:function(t){var o;"undefined"==typeof t?e(".widget .wp-editor-area").each(function(n,i){t=e(i).attr("id"),o=e("#"+t).parents(".widget").attr("id"),"undefined"!=typeof o&&e("#"+o+" .wpglobus_dialog_start.wpglobus_dialog_icon").css("margin-right","20px")}):(o=e("#"+t).parents(".widget").attr("id"),"undefined"!=typeof o&&e("#"+o+" .wpglobus_dialog_start.wpglobus_dialog_icon").css("margin-right","20px"))},addAjaxListener:function(o){e(document).ajaxComplete(function(e,o,n){-1!=n.data.indexOf("action=save-widget")&&(-1!=n.data.indexOf("delete_widget=1")||(t.fixDialogStartIcon(t.ajaxActionId),"undefined"!=typeof t.ajaxActionId&&(window.switchEditors.go(t.ajaxActionId,"tmce"),t.ajaxActionId=void 0)))})},addEditorListener:function(o){var n=e("#"+o).parents(".widget").attr("id");"undefined"!=typeof n&&e("#"+n+" .widget-control-save").on("click",function(n){n.preventDefault(),null==tinymce.get(o)||tinymce.get(o).isHidden()?e("#"+o).val(t.content[o]):tinymce.get(o).setContent(t.content[o]),t.ajaxActionId=o})},addListeners:function(){t.addAjaxListener(),e(document).on("click",".widget-title, .widget-title-action",function(t){t.preventDefault();var o=e(this).parents(".widget").attr("id");window.switchEditors.go(e("#"+o).find(".wp-editor-area").attr("id"),"tmce")})},addButtons:function(){tinymce.PluginManager.add(t.option.button_separator,function(e,o){e.addButton(t.option.button_separator,{text:t.option.text_separator,icon:t.option.icon})}),e.each(WPGlobusCoreData.enabled_languages,function(o,n){tinymce.PluginManager.add(t.option.button+n,function(o,i){var a="";o.id.indexOf("widget-black-studio-")>=0&&n==WPGlobusCoreData.default_language&&(t.fixDialogStartIcon(o.id),t.addEditorListener(o.id),t.content[o.id]=e("#"+o.id).text(),t.language[o.id]=t.option.language,e("#"+o.id).val(t.getTranslation(o,n)),a=" active",o.on("keyup",function(e,n){t.saveContent(o,t.language[o.id])}),e(document).on("change","#"+o.id,function(o){var n=e(this).attr("id");tinymce.get(n).isHidden()&&t.saveContent(n,t.language[n])})),o.addButton(t.option.button+n,{text:WPGlobusCoreData.en_language_name[n],icon:!1,tooltip:"Select "+WPGlobusCoreData.en_language_name[n]+" language",value:n,classes:t.option.button_classes+a+" "+t.option.button_class+n+" "+t.option.button_class+o.id,onclick:function(){var n=e(this),i=n[0]._id,a=WPGlobusCoreData.default_language;"undefined"!=typeof n[0]._value?a=n[0]._value:"undefined"!=typeof n[0].settings.value&&(a=n[0].settings.value),t.removeClass(o.id),e("#"+i).addClass(t.option.activeClass),t.saveContent(o,t.language[o.id]),t.language[o.id]=a,o.setContent(t.getTranslation(o,t.language[o.id]))}})})})}};WPGlobusBSWidget=e.extend({},WPGlobusBSWidget,t),WPGlobusBSWidget.init()}}(jQuery);