!function(t){"use strict";if("undefined"!=typeof WPGlobusBSWidget){var e={option:{language:WPGlobusCoreData.default_language,content:"",activeClass:"mce-active",button_separator:WPGlobusBSWidget.data.button_separator,text_separator:WPGlobusBSWidget.data.text_separator,icon:WPGlobusBSWidget.data.icon,button:WPGlobusBSWidget.data.button,button_class:WPGlobusBSWidget.data.button_class,button_classes:WPGlobusBSWidget.data.button_classes},language:{},content:{},ajaxActionId:void 0,init:function(n){e.option=t.extend(e.option,n),e.addButtons(),e.addListeners(),"tinymce"!=getUserSetting("editor")&&setUserSetting("editor","tinymce")},saveContent:function(n,a){var o,i;"object"==typeof n?(o=n.getContent().replace(/<p>\s*<\/p>/g,""),i=n.id):(i=n,o=t("#"+i).val()),e.content[i]=WPGlobusCore.getString(e.content[i],o,a)},getTranslation:function(t,n){return WPGlobusCore.getTranslations(e.content[t.id])[n]},removeClass:function(n){t(".mce-"+e.option.button_class+n).removeClass(e.option.activeClass)},fixDialogStartIcon:function(e){var n;"undefined"==typeof e?t(".widget .wp-editor-area").each(function(a,o){e=t(o).attr("id"),n=t("#"+e).parents(".widget").attr("id"),"undefined"!=typeof n&&t("#"+n+" .wpglobus_dialog_start.wpglobus_dialog_icon").css("margin-right","20px")}):(n=t("#"+e).parents(".widget").attr("id"),"undefined"!=typeof n&&t("#"+n+" .wpglobus_dialog_start.wpglobus_dialog_icon").css("margin-right","20px"))},addAjaxListener:function(){t(document).ajaxComplete(function(t,n,a){-1!=a.data.indexOf("action=save-widget")&&(-1!=a.data.indexOf("delete_widget=1")||(e.fixDialogStartIcon(e.ajaxActionId),"undefined"!=typeof e.ajaxActionId&&(window.switchEditors.go(e.ajaxActionId,"tmce"),e.ajaxActionId=void 0)))})},addEditorListener:function(n){var a=t("#"+n).parents(".widget").attr("id");"undefined"!=typeof a&&t("#"+a+" .widget-control-save").on("click",function(a){a.preventDefault(),null==tinymce.get(n)||tinymce.get(n).isHidden()?t("#"+n).val(e.content[n]):(tinymce.get(n).setContent(e.content[n]),tinymce.triggerSave()),e.ajaxActionId=n})},addListeners:function(){e.addAjaxListener(),t(document).on("click",".widget-title, .widget-title-action",function(e){e.preventDefault();var n=t(this).parents(".widget").attr("id");window.switchEditors.go(t("#"+n).find(".wp-editor-area").attr("id"),"tmce")})},addButtons:function(){tinymce.PluginManager.add(e.option.button_separator,function(t){t.addButton(e.option.button_separator,{text:e.option.text_separator,icon:e.option.icon})}),t.each(WPGlobusCoreData.enabled_languages,function(n,a){tinymce.PluginManager.add(e.option.button+a,function(n){var o="";n.id.indexOf("widget-black-studio-")>=0&&a==WPGlobusCoreData.default_language&&(e.fixDialogStartIcon(n.id),e.addEditorListener(n.id),e.content[n.id]=t("#"+n.id).text(),e.language[n.id]=e.option.language,t("#"+n.id).val(e.getTranslation(n,a)),o=" active",n.on("blur",function(){e.saveContent(n,e.language[n.id])}),t(document).on("change","#"+n.id,function(){var n=t(this).attr("id");tinymce.get(n).isHidden()&&e.saveContent(n,e.language[n])})),n.addButton(e.option.button+a,{text:WPGlobusCoreData.en_language_name[a],icon:!1,tooltip:"Select "+WPGlobusCoreData.en_language_name[a]+" language",value:a,classes:e.option.button_classes+o+" "+e.option.button_class+a+" "+e.option.button_class+n.id,onclick:function(){var a=t(this),o=a[0]._id,i=WPGlobusCoreData.default_language;"undefined"!=typeof a[0]._value?i=a[0]._value:"undefined"!=typeof a[0].settings.value?i=a[0].settings.value:console.log("Language value not defined. It was set to default."),e.removeClass(n.id),t("#"+o).addClass(e.option.activeClass),e.saveContent(n,e.language[n.id]),e.language[n.id]=i,n.setContent(e.getTranslation(n,e.language[n.id]))}})})})}};WPGlobusBSWidget=t.extend({},WPGlobusBSWidget,e),WPGlobusBSWidget.init()}}(jQuery);